<?xml version="1.0" encoding="utf-8"?>
<InstructionData xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <DateTime>132954138310147748</DateTime>
  <GameVersion>0.2.3229.16142</GameVersion>
  <Title>PC-AV2-HP - Pressure Control Dual Activve Vent</Title>
  <Description>â€‹</Description>
  <Author>Unknown</Author>
  <WorkshopFileHandle>0</WorkshopFileHandle>
  <Instructions># Atmospheric Reglator
# https://github.com/dtandersen/stationeers-library
alias GasSensor d0
alias Intake d1
alias Relief d2

define hysteresis 1
define deadband 2
#alias device r0
alias maxpres r1
alias minpres r2
alias pressure r3
#alias spmin r4
#alias spmax r5
#alias reliefPres r6
alias reliefsp r6
#alias intakePres r11
alias intakesp r11
#alias ratioH2 r7
#alias ratioX r8
#alias ratioBad r9
#alias purgeOn r10
alias hazard r10

alias selector r13
alias temp r13
alias temp1 r13
alias temp2 r14

#define MAXPRES 102
#define MINPRES 100
define SP 101.325

init:
#div temp1 deadband 2
#move spmin SP
#move spmax SP
add maxpres SP hysteresis
sub minpres SP hysteresis
s Intake Lock 0
s Intake Mode 1
s Intake On 1
s Relief Lock 0
s Relief Mode 1
s Relief On 1

move intakesp minpres
move reliefsp maxpres
loop:
jal checkhazard

mul intakesp maxpres 1.1

l pressure GasSensor Pressure
#bnez hazard pos
neg:
slt selector pressure intakesp
select intakesp selector SP minpres

sgt selector pressure reliefsp
select reliefsp selector SP maxpres

beqz hazard safe
mul intakesp maxpres 1.025
mul reliefsp minpres 0.975
safe:
#j set
#pos:
#slt selector pressure intakePres
#select intakePres selector maxpres SP

#sgt selector pressure reliefPres
#select reliefPres selector minpres SP

set:
s Intake PressureExternal 0
s Intake PressureInternal intakesp

s Relief PressureExternal reliefsp
s Relief PressureInternal 40000

move temp intakesp
round temp temp
mul temp temp 100000
add temp temp reliefsp
round temp temp
s db Setting temp
yield
j loop

checkhazard:
l temp1 GasSensor RatioVolatiles
l temp2 GasSensor RatioPollutant
max temp1 temp1 temp2
sgt hazard temp1 0.005
j ra</Instructions>
</InstructionData>