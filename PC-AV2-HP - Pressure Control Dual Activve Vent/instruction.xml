<?xml version="1.0" encoding="utf-8"?>
<InstructionData xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <DateTime>132954138310147748</DateTime>
  <GameVersion>0.2.3229.16142</GameVersion>
  <Title>PC-AV2-HP - Pressure Control Dual Activve Vent</Title>
  <Description>â€‹</Description>
  <Author>Unknown</Author>
  <WorkshopFileHandle>0</WorkshopFileHandle>
  <Instructions># Atmospheric Reglator
# https://github.com/dtandersen/stationeers-library
alias GasSensor d0
alias Intake d1
alias Relief d2

define SP 101.325
define hysteresis 1
define TOXIC 0.5 #kpa

alias maxpres r1
alias minpres r2
alias pressure r3
alias reliefsp r6
alias intakesp r11
alias hazard r10
alias selector r13
alias temp1 r13
alias temp2 r14

init:
add maxpres SP hysteresis
sub minpres SP hysteresis
s Intake Lock 0
s Intake Mode 1
s Intake On 1
s Relief Lock 0
s Relief Mode 1
s Relief On 1

move intakesp minpres
move reliefsp maxpres

loop:
l pressure GasSensor Pressure
jal checkhazard

slt selector pressure intakesp
select intakesp selector SP minpres

sgt selector pressure reliefsp
select reliefsp selector SP maxpres

beqz hazard safe
mul intakesp maxpres 1.025
mul reliefsp minpres 0.975

safe:
s Intake PressureExternal 40000
s Intake PressureInternal intakesp

s Relief PressureExternal reliefsp
s Relief PressureInternal 40000

move temp1 intakesp
round temp1 temp1
mul temp1 temp1 100000
add temp1 temp1 reliefsp
round temp1 temp1
s db Setting temp1
yield
j loop

checkhazard:
l temp1 GasSensor RatioVolatiles
l temp2 GasSensor RatioPollutant
add temp1 temp1 temp2 # volatiles + pollutant
mul temp1 temp1 pressure # toxins * pressure
sge hazard temp1 TOXIC
j ra</Instructions>
</InstructionData>